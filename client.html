<script src="/socket.io/socket.io.js"></script>
<script src="/node_modules/audiolib/lib/audiolib.js"></script>

<script src="/src/jsmad/mad.js"></script>

<script src="/src/jsmad/rq_table.js"></script>
<script src="/src/jsmad/imdct_s.js"></script>
<script src="/src/jsmad/huffman.js"></script>
<script src="/src/jsmad/bit.js"></script>
<script src="/src/jsmad/stream.js"></script>
<script src="/src/jsmad/layer3.js"></script>
<script src="/src/jsmad/frame.js"></script>
<script src="/src/jsmad/synth.js"></script>

<script src="/src/jsmad/bytestream.js"></script>
<script src="/src/jsmad/filestream.js"></script>
<script src="/src/jsmad/substream.js"></script>
<script src="/src/jsmad/id3v22stream.js"></script>
<script src="/src/jsmad/id3v23stream.js"></script>
<script src="/src/jsmad/mp3file.js"></script>
<script src="/src/jsmad/stringstream.js"></script>

<script src="/src/jsmad/player.js"></script>


<script>
	(function(){
window.onload	= function(){

	var player, stream, socket;
    socket = io.connect('http://localhost:1337');
    socket.emit('newSong');
    window.nextSong = function() {
        player.setPlaying(false);
		stream = undefined;	
		player = undefined;
		socket.emit('newSong');
	};
	
	window.pause = function() {
		if (player !== undefined) {
			player.setPlaying(!player.playing);
		}
	}

	socket.on('data', function (song, data) {
  	  if (stream !== undefined) {
  	  	stream.buffer(data);
  	  } else {
  	    console.log(song);
  	    stream = new Mad.StringStream(data);
  	  }  
  	  
	  if (player === undefined) {
		  player = new Mad.Player(stream);
		  player.onPlay = function() {
			  console.log('Update play UI');
		  }
		  player.onPause = function() {
			  console.log('update pause UI');
		  }
		  player.createDevice();  	  
		  player.setPlaying(true);
  	  }
    });
};
}());
</script>
	<body>
		<button onclick="nextSong()">Next</button>
		<button onclick="pause()">Pause</button>
	</body>